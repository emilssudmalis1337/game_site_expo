{% extends "base.html" %}
{% block content %}

<h2 class="text-center my-4">Game Database – Update</h2>

{% if error %}
<div class="alert alert-danger" role="alert">{{ error }}</div>
{% endif %}

<form class="col-6 mx-auto card p-3 shadow-lg"
      method="post"
      enctype="multipart/form-data">
    {% csrf_token %}

    <h3 class="mb-3">Update Game</h3>
    <hr>

    <!-- ====================== REQUIRED FIELDS ====================== -->
    <div class="form-group mb-3">
        <label>Title *</label>
        <input name="game_name"
               type="text"
               class="form-control"
               value="{{ game.game_name }}"
               required>
    </div>

    <div class="form-group mb-3">
        <label>Genre *</label>
        <select name="genre" class="form-control" required>
            <option value="">-- Choose genre --</option>
            {% for g in genres %}
                <option value="{{ g.id }}"
                        {% if game.genre.id == g.id %}selected{% endif %}>
                    {{ g.Genre_Name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group mb-3">
        <label>Platform *</label>
        <select name="platform" class="form-control" required>
            <option value="">-- Choose platform --</option>
            {% for p in platforms %}
                <option value="{{ p.id }}"
                        {% if game.platform.id == p.id %}selected{% endif %}>
                    {{ p.Platform_Name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group mb-3">
        <label>Store *</label>
        <select name="store" class="form-control" required>
            <option value="">-- Choose store --</option>
            {% for s in stores %}
                <option value="{{ s.id }}"
                        {% if game.store.id == s.id %}selected{% endif %}>
                    {{ s.Store_Name }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- ====================== OPTIONAL BUTTON ====================== -->
    <button class="btn btn-outline-secondary mb-3"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#optionalFields"
            aria-expanded="false"
            aria-controls="optionalFields">
        Optional ▼
    </button>

    <!-- ====================== OPTIONAL FIELDS (collapsed) ====================== -->
    <div class="collapse" id="optionalFields">

        <!-- Size -->
        <div class="optional-field mb-3">
            <label>Size</label>
            <select name="size" class="form-control">
                <option value="">-- none --</option>
                {% for sz in sizes %}
                    <option value="{{ sz.id }}"
                            {% if game.size and game.size.id == sz.id %}selected{% endif %}>
                        {{ sz.size_type }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Developer -->
        <div class="optional-field mb-3">
            <label>Developer</label>
            <select name="developer" class="form-control">
                <option value="">-- none --</option>
                {% for d in developers %}
                    <option value="{{ d.id }}"
                            {% if game.developer and game.developer.id == d.id %}selected{% endif %}>
                        {{ d }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Publisher -->
        <div class="optional-field mb-3">
            <label>Publisher</label>
            <select name="publisher" class="form-control">
                <option value="">-- none --</option>
                {% for p in publishers %}
                    <option value="{{ p.id }}"
                            {% if game.publisher and game.publisher.id == p.id %}selected{% endif %}>
                        {{ p.publisher_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- DLC -->
        <div class="optional-field mb-3">
            <label>DLC</label>
            <select name="dlc" class="form-control">
                <option value="">-- none --</option>
                {% for d in dlcs %}
                    <option value="{{ d.id }}"
                            {% if game.dlc and game.dlc.id == d.id %}selected{% endif %}>
                        {{ d.dlc_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Game mode -->
        <div class="optional-field mb-3">
            <label>Game mode</label>
            <select name="game_mode" class="form-control">
                <option value="">-- none --</option>
                {% for gm in gamemodes %}
                    <option value="{{ gm.id }}"
                            {% if game.game_mode and game.game_mode.id == gm.id %}selected{% endif %}>
                        {{ gm.mode_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- License -->
        <div class="optional-field mb-3">
            <label>License</label>
            <select name="license" class="form-control">
                <option value="">-- none --</option>
                {% for l in licenses %}
                    <option value="{{ l.id }}"
                            {% if game.license and game.license.id == l.id %}selected{% endif %}>
                        {{ l.license_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- System requirements -->
        <div class="optional-field mb-3">
            <label>System requirements</label>
            <select name="system_requirements" class="form-control">
                <option value="">-- none --</option>
                {% for sr in sysreqs %}
                    <option value="{{ sr.id }}"
                            {% if game.system_requirements and game.system_requirements.id == sr.id %}selected{% endif %}>
                        {{ sr.operating_system }} – {{ sr.processor }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Review -->
        <div class="optional-field mb-3">
            <label>Review</label>
            <select name="review" class="form-control">
                <option value="">-- none --</option>
                {% for r in reviews %}
                    <option value="{{ r.id }}"
                            {% if game.review and game.review.id == r.id %}selected{% endif %}>
                        Rating {{ r.rating }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Multimedia -->
        <div class="optional-field mb-3">
            <label>Multimedia</label>
            <select name="multimedia" class="form-control">
                <option value="">-- none --</option>
                {% for m in multimedias %}
                    <option value="{{ m.id }}"
                            {% if game.multimedia and game.multimedia.id == m.id %}selected{% endif %}>
                        {{ m.website }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Status -->
        <div class="optional-field mb-3">
            <label>Status</label>
            <select name="status" class="form-control">
                <option value="">-- none --</option>
                {% for st in statuses %}
                    <option value="{{ st.id }}"
                            {% if game.status and game.status.id == st.id %}selected{% endif %}>
                        {{ st.status_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Sales history -->
        <div class="optional-field mb-3">
            <label>Sales history</label>
            <select name="sales_history" class="form-control">
                <option value="">-- none --</option>
                {% for sh in sales_histories %}
                    <option value="{{ sh.id }}"
                            {% if game.sales_history and game.sales_history.id == sh.id %}selected{% endif %}>
                        {{ sh.units_sold }} sold
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Game log -->
        <div class="optional-field mb-3">
            <label>Game log</label>
            <select name="game_log" class="form-control">
                <option value="">-- none --</option>
                {% for gl in gamelogs %}
                    <option value="{{ gl.id }}"
                            {% if game.game_log and game.game_log.id == gl.id %}selected{% endif %}>
                        {{ gl.log_description|truncatechars:30 }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Rating -->
        <div class="optional-field mb-3">
            <label>Rating</label>
            <select name="rating" class="form-control">
                <option value="">-- none --</option>
                {% for ra in ratings %}
                    <option value="{{ ra.id }}"
                            {% if game.rating and game.rating.id == ra.id %}selected{% endif %}>
                        {{ ra.rating_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Online status -->
        <div class="optional-field mb-3">
            <label>Online status</label>
            <select name="online_status" class="form-control">
                <option value="">-- none --</option>
                {% for os in online_statuses %}
                    <option value="{{ os.id }}"
                            {% if game.online_status and game.online_status.id == os.id %}selected{% endif %}>
                        {{ os.active_players }} active / {{ os.registered_players }} total
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Award -->
        <div class="optional-field mb-3">
            <label>Award</label>
            <select name="award" class="form-control">
                <option value="">-- none --</option>
                {% for aw in awards %}
                    <option value="{{ aw.id }}"
                            {% if game.award and game.award.id == aw.id %}selected{% endif %}>
                        {{ aw.award_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Language -->
        <div class="optional-field mb-3">
            <label>Language</label>
            <select name="language" class="form-control">
                <option value="">-- none --</option>
                {% for lg in languages %}
                    <option value="{{ lg.id }}"
                            {% if game.language and game.language.id == lg.id %}selected{% endif %}>
                        {{ lg.language_name }}
                    </option>
                {% endfor %}
            </select>
        </div>

    </div>   <!-- end of .collapse -->

    <button type="submit" class="btn btn-success mt-3">Update Game</button>
</form>

{% endblock %}